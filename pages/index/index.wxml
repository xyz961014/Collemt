<!--index.wxml-->
<view class="page">
  <view class="userinfo">
    <button wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo"> 登录 </button>
    <block wx:else>
      <image class="userinfo-avatar" src="{{userInfo.avatarUrl}}" background-size="cover"></image>
      <text class="userinfo-nickname">{{userInfo.nickName}}</text>
      <text class='user-score'>得分：{{score}}</text>
    </block>
  </view>
 <view class="weui-cells__title"> 存储空间 </view>
        <view class="weui-progress">
            <view class="weui-progress__bar">
                <progress percent="{{percentage}}" stroke-width="3" />
            </view>
        </view>
         <view class="weui-cells__title">{{percentage}}%已用</view>
 <view class="weui-cells__title"> 任务完成进度 </view>
        <view class="weui-progress">
            <view class="weui-progress__bar">
                <progress percent='{{numfinished / numall * 100}}' stroke-width="3" />
            </view>
        </view>
         <view class="weui-cells__title">{{numfinished}}/{{numall}}</view>
  <view class="weui-panel weui-panel_access">
            <view class="weui-panel__hd">已完成任务（任务包编号：{{numpackage}}）</view>
            <view class="weui-panel__bd">
            <block wx:for="{{history}}">
                <view class="weui-media-box weui-media-box_text" data-num='{{index}}' bindtap='historytap'>
                    <view class="weui-media-box__title weui-media-box__title_in-text">{{item.text.textID}}. {{item.text.text}}</view>
                    <view class="weui-media-box__desc">{{item.record.time}}</view>
                </view>
            </block>
            </view>
  </view>

    <block wx:if='{{hasUserInfo}}'>
      <button wx:if="{{!canNewpackage}}" class="weui-btn" type="primary" bindtap='uploadpackage'>上传任务包</button>
      <button wx:else class="weui-btn" type="primary" bindtap='newpackage'>获取新任务</button>
    </block>


</view>

